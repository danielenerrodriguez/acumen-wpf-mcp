@inherits LayoutComponentBase
@implements IDisposable
@inject IAppState State

<div class="flex flex-col h-screen">
    @* Status bar *@
    <header class="flex items-center justify-between px-4 py-2 bg-surface-lighter border-b border-gray-700 shrink-0">
        <div class="flex items-center gap-3">
            <span class="text-accent-light font-bold text-sm tracking-wide">WPF MCP</span>
            <span class="text-gray-500 text-xs">Dashboard</span>
        </div>
        <div class="flex items-center gap-3 text-xs">
            @if (State.IsAttached)
            {
                <span class="inline-flex items-center gap-1.5">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    <span class="text-green-400">@State.WindowTitle</span>
                    <span class="text-gray-500">PID @State.ProcessId</span>
                </span>
            }
            else
            {
                <span class="inline-flex items-center gap-1.5">
                    <span class="w-2 h-2 rounded-full bg-gray-500"></span>
                    <span class="text-gray-400">Not attached</span>
                </span>
            }
        </div>
    </header>

    @* Main content *@
    <div class="flex-1 overflow-hidden">
        @Body
    </div>
</div>

@code {
    private Timer? _statusTimer;

    protected override void OnInitialized()
    {
        // Poll attachment status every 3 seconds for status bar
        _statusTimer = new Timer(_ => InvokeAsync(StateHasChanged), null, 3000, 3000);
        State.OnAttachChanged += HandleAttachChanged;
    }

    private void HandleAttachChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        _statusTimer?.Dispose();
        State.OnAttachChanged -= HandleAttachChanged;
    }
}
