@inherits LayoutComponentBase
@implements IDisposable
@inject IAppState State

<div class="flex flex-col h-screen">
    @* Header bar â€” dark navy like Deltek's top nav *@
    <header class="flex items-center justify-between px-5 py-2.5 bg-deltek shrink-0 shadow-md">
        <div class="flex items-center gap-3">
            <span class="text-white font-bold text-sm tracking-wide">WPF MCP</span>
            <span class="text-blue-300 text-xs font-medium">Dashboard</span>
        </div>
        <div class="flex items-center gap-3 text-xs">
            @if (State.IsAttached)
            {
                <span class="inline-flex items-center gap-1.5">
                    <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
                    <span class="text-white font-medium">@State.WindowTitle</span>
                    <span class="text-white/70">PID @State.ProcessId</span>
                </span>
            }
            else
            {
                <span class="inline-flex items-center gap-1.5">
                    <span class="w-2 h-2 rounded-full bg-white/40"></span>
                    <span class="text-white/50">Not attached</span>
                </span>
            }
        </div>
    </header>

    @* Main content *@
    <div class="flex-1 overflow-hidden">
        @Body
    </div>
</div>

@code {
    private Timer? _statusTimer;

    protected override void OnInitialized()
    {
        // Poll attachment status every 3 seconds for status bar
        _statusTimer = new Timer(_ => InvokeAsync(StateHasChanged), null, 3000, 3000);
        State.OnAttachChanged += HandleAttachChanged;
    }

    private void HandleAttachChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        _statusTimer?.Dispose();
        State.OnAttachChanged -= HandleAttachChanged;
    }
}
