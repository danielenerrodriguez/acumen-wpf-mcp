<div class="flex flex-col h-full">
    <div class="panel-header flex items-center justify-between px-3 py-2 shrink-0">
        <span class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">Properties</span>
        @if (RefKey != null)
        {
            <span class="text-xs text-deltek dark:text-accent-light font-medium bg-deltek-bg dark:bg-accent-bg px-2 py-0.5 rounded">@RefKey</span>
        }
    </div>
    <div class="flex-1 overflow-auto">
        @if (Properties == null || Properties.Count == 0)
        {
            <p class="text-gray-400 dark:text-gray-500 text-xs p-3">Select an element to view properties.</p>
        }
        else
        {
            <table class="w-full text-xs">
                <tbody>
                    @foreach (var kv in Properties)
                    {
                        var isChanged = ChangedKeys.Contains(kv.Key);
                        <tr class="border-b border-gray-100 dark:border-dm-border hover:bg-gray-50 dark:hover:bg-dm-lighter @(isChanged ? "bg-blue-50 dark:bg-accent/10" : "")">
                            <td class="px-3 py-1.5 text-gray-500 dark:text-gray-400 font-medium whitespace-nowrap">
                                @if (isChanged)
                                {
                                    <span class="text-deltek dark:text-accent-light font-semibold">@kv.Key</span>
                                }
                                else
                                {
                                    @kv.Key
                                }
                            </td>
                            <td class="px-3 py-1.5 @(isChanged ? "text-deltek dark:text-accent-light font-bold" : GetValueColor(kv.Key)) font-mono break-all">
                                @kv.Value
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</div>

@code {
    [Parameter] public string? RefKey { get; set; }
    [Parameter] public Dictionary<string, string>? Properties { get; set; }
    [Parameter] public HashSet<string> ChangedKeys { get; set; } = new();

    /// <summary>Highlight enriched pattern values with distinct colors.</summary>
    private static string GetValueColor(string key) => key switch
    {
        "Value" => "text-emerald-600 dark:text-green-400",
        "ToggleState" => "text-blue-600 dark:text-blue-400",
        "IsSelected" => "text-blue-600 dark:text-blue-400",
        "ExpandCollapseState" => "text-blue-600 dark:text-blue-400",
        "RangeValue" or "RangeMinimum" or "RangeMaximum" => "text-cyan-600 dark:text-cyan-400",
        "SelectedItems" => "text-cyan-600 dark:text-cyan-400",
        "IsEnabled" => "text-amber-600 dark:text-yellow-400",
        "IsOffscreen" => "text-amber-600 dark:text-yellow-400",
        _ => "text-gray-700 dark:text-gray-300"
    };
}
