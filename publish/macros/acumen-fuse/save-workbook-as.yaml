name: Save Workbook As
description: Saves the current Acumen Fuse workbook to a new file location
timeout: 30
parameters:
  - name: filePath
    description: Full path for the new workbook file (.afw)
    required: true
  - name: exePath
    description: Path to Fuse.exe
    required: false
    default: 'C:\Program Files\Deltek\Acumen 8.12\Fuse.exe'

steps:
  # Inlined from acumen-fuse/launch
  - action: launch
    exe_path: '{{exePath}}'
    if_not_running: true
    timeout: 60
  - action: wait_for_window
    title_contains: ' - Deltek Acumen'
    timeout: 90
    retry_interval: 2

  - action: focus
  - action: send_keys
    keys: Alt,F,A,D

  # Save As dialog uses DirectUI ComboBox (FileNameControlHost), not standard 1148
  - action: wait
    seconds: 2

  - action: find
    automation_id: FileNameControlHost
    timeout: 5

  - action: type
    text: '{{filePath}}'

  - action: send_keys
    keys: Enter

  # Handle "file already exists" overwrite dialog (Yes is left of No)
  # Harmless if file doesn't exist â€” keystrokes go to main window
  - action: wait
    seconds: 1
  - action: send_keys
    keys: Left,Enter

  - action: wait
    seconds: 1
