name: Export Diagnostics to Excel
description: Exports the current Fuse diagnostics results to an Excel file
timeout: 60
parameters:
  - name: filePath
    description: Full path for the output Excel file (.xlsx)
    required: true
  - name: exePath
    description: Path to Fuse.exe
    required: false
    default: 'C:\Program Files\Deltek\Acumen 8.12\Fuse.exe'

# Prerequisites: Fuse analysis must have been run on S2 // Diagnostics tab

steps:
  # Inlined from acumen-fuse/launch
  - action: launch
    exe_path: '{{exePath}}'
    if_not_running: true
    timeout: 60
  - action: wait_for_window
    title_contains: ' - Deltek Acumen'
    timeout: 90
    retry_interval: 2

  # Ensure we're on S2 // Diagnostics tab
  - action: focus
  - action: find
    automation_id: uxRibbons
    timeout: 5
    save_as: diagnosticsTab
  - action: click
    ref: diagnosticsTab

  - action: wait
    seconds: 1

  # Click Publish menu > find "To Excel" option
  - action: find
    automation_id: PublishAnalysisMenuTool
    timeout: 5
    save_as: publishMenu
  - action: click
    ref: publishMenu

  - action: wait
    seconds: 1

  # Find and click "To Microsoft Excel®" in the dropdown
  - action: find
    name: "To Microsoft Excel®"
    control_type: MenuItem
    timeout: 5
    save_as: toExcelItem
  - action: click
    ref: toExcelItem

  # Save As dialog — need to check which type appears (standard vs DirectUI)
  - action: wait
    seconds: 2

  - action: find
    automation_id: FileNameControlHost
    timeout: 5

  - action: type
    text: '{{filePath}}'

  - action: send_keys
    keys: Enter

  # Wait for export to complete
  - action: wait_for_enabled
    automation_id: uxRibbons
    timeout: 30
