# Acumen Fuse Knowledge Base
# For use by AI agents navigating Deltek Acumen Fuse via WPF MCP tools
# Version: 8.12.0 x64
# Last updated: 2026-02-26 (updated workflows for verify steps with match_mode, fixed stale macro refs for deleted macros, added verify best practices)

kind: knowledge-base

update_instructions:
  when_to_update:
    - "After discovering new automation IDs via wpf_snapshot or wpf_find"
    - "After verifying predicted keytip sequences via live send_keys testing"
    - "When new macros are created (add to workflows section)"
    - "When the Acumen application version changes"
    - "After discovering new dialog automation IDs or control structures"
    - "After testing a macro or workflow and observing unexpected behavior"
    - "When an entry's status changes (e.g., predicted keytip confirmed or found wrong)"
  how_to_update:
    - "Read the current _knowledge.yaml file"
    - "Add or modify the relevant section"
    - "Write back via cmd.exe copy (WSL /mnt/c/ writes can silently fail)"
    - "The MCP server auto-reloads via FileSystemWatcher on changes"
  validation:
    - "Ensure 'kind: knowledge-base' is present at the top level"
    - "YAML must parse without errors"
    - "New automation IDs should be verified via live wpf_find before adding"
    - "New keytip sequences should be verified via live send_keys before marking as verified"
  file_convention:
    - "Knowledge base files use underscore prefix: _knowledge.yaml"
    - "One knowledge base per product subfolder (e.g., acumen-fuse/_knowledge.yaml)"
    - "The MCP server skips _*.yaml files from macro loading"
    - "Knowledge bases are served as MCP resources and summarized in wpf_macro_list"

  saving_workflows:
    description: >
      AI agents should offer to save frequently-used workflows as reusable macros
      using the wpf_save_macro tool. This makes common operations faster and more
      reliable on subsequent runs.
    when_to_offer:
      - "After completing a workflow with 3+ steps that isn't already a macro"
      - "When a user repeats a similar sequence of actions across sessions"
      - "After successfully automating a complex multi-step task"
    how_to_save:
      - "Collect the steps performed into a clean step list (action + relevant fields only)"
      - "Call wpf_save_macro with a descriptive name and the steps as JSON"
      - "The product folder is auto-derived from the attached process"
      - "Parameters should be extracted for values that vary between runs (e.g., file paths)"
    naming_conventions:
      - "Use lowercase kebab-case for macro names (e.g., 'import-xer', 'run-diagnostics')"
      - "Names should describe the workflow action, not the application state"
      - "Keep names concise but descriptive (2-4 words)"
    best_practices:
      - "Always use the wpf_save_macro MCP tool to save macros — never write YAML files manually with the Write tool"
      - "Proactively offer to save workflows as macros after completing a multi-step task — do not wait for the user to ask"
      - "Minimize wait steps — only add waits where timing is critical (loading, dialog transitions)"
      - "Use save_as aliases in find steps and reference them in subsequent click/type steps"
      - "Extract variable values (file paths, search terms) as parameters with defaults"
      - "Keep total cumulative wait under 12-15 seconds to avoid MCP tool timeout"
      - "NEVER use action: macro (sub-macro calls) — they will always exceed the MCP client timeout (~15-20s). Always inline the sub-macro steps directly into the parent macro YAML instead."
      - "Include blind dialog dismissal steps (e.g., Left,Enter for overwrite, Tab,Enter for Mentor) even when dialogs may not appear — harmless if no dialog is present. Note: Mentor dialogs only appear on S3 Risk tabs, not on other tabs."
      - "Prefer wait_for_enabled over static wait steps when waiting for import/processing to complete — use automation_id: uxRibbons with timeout: 30 to poll until tabs become enabled"
      - "IMPORT MACRO PATTERN: Use keytips for file dialog open (Alt,S,O,A) and Import All (Alt,S,R,I) — these are fast with no UI tree search. Use find+click for post-import navigation (tab switching, button clicks) — these are reliable. Always include wait: 2 before Import All keytips to let the file load into the project tree. The reference implementation is import-mpp-circular-logic.yaml."
      - "AVOID using find+click for Import All — the find operation searches the full UI tree which is slow on Fuse's complex interface. Keytips (Alt,S,R,I) are faster and equally reliable when preceded by a wait: 2 and focus step."
      - "IMPORT VERIFICATION PATTERN: All import macros should end with a find_by_path to the Projects tree root TextBlock (path: ['SearchProp:AutomationId~PART_TreeView', 'SearchProp:ControlType~TreeItem', 'SearchProp:ControlType~Text']) followed by a verify step with property: name, match_mode: not_equals, expected: 'Workbook1 (0)'. This confirms activities were actually loaded. The find_by_path with its retry timeout serves as both the wait and the verification — no separate wait_for_enabled is needed after import."
      - "OPERATION COMPLETION PATTERN: For macros that run analysis (F9, risk, forensics) or file operations (save, export, open), end with wait_for_enabled on automation_id: uxRibbons instead of blind wait steps. This polls until tabs become enabled, adapting to operation duration."

  # Inline annotation conventions for AI agents
  annotations:
    description: >
      AI agents should annotate knowledge base entries inline to track
      verification status, record issues, and leave notes for future agents.
      This avoids stale or misleading information accumulating over time.
    fields:
      status:
        description: "Verification status of the entry"
        values:
          verified: "Confirmed working via live testing"
          predicted: "Derived from source code analysis, not yet tested live"
          failed: "Tested live and did not work as expected"
          untested: "Added but never tested"
          deprecated: "Was working but may no longer apply (version change, etc.)"
      last_tested:
        description: "ISO date (YYYY-MM-DD) of last live verification"
        example: "2026-02-24"
      issues:
        description: "Known problems, unexpected behaviors, or caveats. Use a list for multiple issues."
        example: "['Tab switch has no visible effect without imported data', 'Screenshot tool does not capture modal dialogs']"
      notes:
        description: "General context, tips, or explanation. Already widely used in this file."
    rules:
      - "When you test something and it works, set status: verified and last_tested to today"
      - "When you test something and it fails, set status: failed, add an issues entry explaining what happened, and set last_tested"
      - "When adding new entries from source code analysis alone, set status: predicted"
      - "When correcting an entry, update the value AND add a note explaining the correction"
      - "Do NOT delete failed entries — mark them as failed with issues so future agents know"
      - "Prefer specific issues over vague ones: 'Alt,S0 does not activate Diagnostics tab' is better than 'did not work'"

application:
  name: Deltek Acumen Fuse
  version: "8.12.0 x64"
  exe_path: "C:\\Program Files\\Deltek\\Acumen 8.12\\Fuse.exe"
  framework: WPF (Infragistics XamRibbon)
  process_name: Fuse

  startup_phases:
    - phase: splash
      duration_seconds: "0-2"
      title_contains: "Please wait while the application opens"
      notes: "Splash screen, first window handle"
    - phase: loading
      duration_seconds: "2-12"
      title_contains: "Deltek Acumen"
      notes: "Loading/initializing, second window handle"
    - phase: ready
      duration_seconds: "12+"
      title_contains: " - Deltek Acumen"
      notes: >
        Application ready. Title is always '<name> - Deltek Acumen' (with dash).
        Use ' - Deltek Acumen' (with leading space+dash) as the readiness check —
        it matches both 'Workbook1 - Deltek Acumen' and '<savedname> - Deltek Acumen'
        but NOT the bare 'Deltek Acumen' loading phase title.

# ============================================================
# INSTALLATION DIRECTORY
# ============================================================
# Paths vary by Acumen version. Check C:\Program Files\Deltek\ for installed versions.
installation:
  base_path: "C:\\Program Files\\Deltek\\Acumen 8.12"
  exe: Fuse.exe
  notes: "Path varies by version. The base_path contains the exe, DLLs, and subfolders below."

  samples:
    path: "{{base_path}}\\Samples"
    notes: "Sample data files for testing. Contents vary by Acumen version."
    workbooks:
      - file: AcumenSampleWorkbookP6.afw
        description: "Pre-built sample workbook with Primavera P6 data"
      - file: AcumenSampleWorkbookMSP.afw
        description: "Pre-built sample workbook with Microsoft Project data"
    primavera_xer:
      - file: "Initial  Plan.xer"
        description: "Initial plan baseline (NOTE: double space in filename)"
      - file: "1 Month Update.xer"
        description: "1-month status update"
      - file: "6 Month Update.xer"
        description: "6-month status update"
      - file: "1 Year Update.xer"
        description: "1-year status update"
      - file: "Current Schedule.xer"
        description: "Current schedule snapshot"
      - file: "New Project.xer"
        description: "Empty new project template"
      - file: snapshots.xer
        description: "Multiple snapshots for trend analysis"
    microsoft_project:
      - file: "Initial Plan.mpp"
      - file: "1 Month Update.mpp"
      - file: "6 Month Update.mpp"
      - file: "1 Year Update.mpp"
      - file: "Current Schedule.mpp"
      - file: "New Project.mpp"
    primavera_xml:
      path: "{{base_path}}\\Samples\\Primavera P6 XML"
      files: ["Initial_Plan.xml", "1_Month_Update.xml", "6_Month_Update.xml", "Current_Schedule.xml", "1_Year_Update.xml", "snapshots.xml"]
    open_plan:
      files: ["InitialPlan.bk3", "1MonthUpdate.bk3", "6MonthUpdate.bk3", "1YearUpdate.bk3", "CurrentSchedule.bk3"]
    asta_powerproject:
      files: ["Initial Plan.pp", "1 Month Update.pp", "6 Month Update.pp", "1 Year Update.pp", "Current Schedule.ppx", "Current Schedule.pp"]
    excel_cost:
      - file: PopulatedRiskRegister.xlsx
        description: "Sample risk register for import"
      - file: CostRiskTemplate.xlsx
        description: "Cost risk analysis template"
      - file: SampleCostRisk.xlsx
        description: "Sample cost risk data"
      - file: "PrismG2 Sample.xlsx"
        description: "ARES PRISM G2 sample data"
      - file: Status-update.xlsx
        description: "Status update data"
      - file: WADTemplate.xlsx
        description: "Work Authorization Document template"
      - file: "X12 CAP.xlsx"
        description: "X12 CAP cost data"

  templates:
    path: "{{base_path}}\\Templates"
    metric_templates:
      - file: dcma.aft
        description: "DCMA 14-point assessment metrics"
      - file: gao.aft
        description: "GAO schedule assessment metrics"
      - file: nasa.aft
        description: "NASA health check metrics"
      - file: dcma_decm_metrics_89_DECM_V7.0.aft
        description: "DCMA DECM metrics v7.0"
      - file: SNAP_Metric_Examples.aft
        description: "SNAP metric examples"
    workbook_templates:
      - file: DOE_EVMS_metrics_87_EVMS_V8.0_workbooktemplate.afw
        description: "DOE EVMS v8.0 workbook template"
      - file: DOE_EVMS_metrics_87_EVMS_IRSA_V8.0_workbooktemplate.afw
        description: "DOE EVMS IRSA v8.0 workbook template"
      - file: DOE_EVMS_metrics_87_IRSA_V8.0_workbooktemplate.afw
        description: "DOE IRSA v8.0 workbook template"
    report_templates:
      - file: ExecutiveBriefingTemplate.xml
      - file: RiskExecutiveBriefingTemplate.xml

  skills:
    path: "{{base_path}}\\Skills"
    folders: [NarrativeSkills, RiskSkills]
    notes: "AI/GenAI skills for Acumen Mentor feature"

  decm_samples:
    path: "{{base_path}}\\DECM Samples"
    notes: "DCMA DECM cost data samples with CSV and WAD templates"
    files:
      - CSV_Template.csv
      - WAD_Template.xlsx
    folders: [Baseline, Month1, Month2, Time_Phased, CSV_CostFileFormat]

  documentation:
    path: "{{base_path}}\\Documentation"
    notes: "Product documentation folder"

# ============================================================
# KEYBOARD SHORTCUTS (InputBindings from MainView.xaml)
# ============================================================
keyboard_shortcuts:
  - key: F1
    action: Display help for current tab
    command: DisplayCurrentTabHelpCommand
  - key: F9
    action: Run Fuse analysis
    command: FuseCommand
  - key: NumpadAdd
    action: Expand current node
    command: ExpandCommand
  - key: NumpadSubtract
    action: Collapse current node
    command: CollapseCommand
  - key: NumpadMultiply
    action: Expand all nodes
    command: ExpandAllCommand
  - key: NumpadDivide
    action: Collapse all nodes
    command: CollapseAllCommand
  - key: Ctrl+Shift+F5
    action: UIA copy details (debug)
    command: UiaCopyDetailsCommand
  - key: Ctrl+Shift+F6
    action: UIA copy all (debug)
    command: UiaCopyAllCommand

# ============================================================
# KEYTIPS (Infragistics XamRibbon auto-generated from Caption/Header)
# ============================================================
# Keytips are auto-generated by Infragistics from the first letter of
# the Header (tabs) or Caption (tools). Conflicts get disambiguation
# suffixes (0, 1, 2...). Press Alt to activate keytip mode.
#
# VERIFIED keytip sequences (tested live):
#   Alt,S,O,A  -> S1 Projects > Oracle Primavera > Add P6 file (All types)
#   Alt,S,R,I  -> S1 Projects > Import group > Import All
#   Alt,F,C    -> File menu > Close
#   Alt,F,N    -> File menu > New
#   Alt,F,O    -> File menu > Open
#   Alt,F,S    -> File menu > Save

keytips:
  notes: >
    Keytips are 100% auto-generated by Infragistics XamRibbon from
    Caption/Header text. No explicit KeyTip= attributes exist in the
    codebase. The exact disambiguation for conflicting tabs (all S*
    tabs start with 'S') must be discovered via live testing. Known
    working sequences are listed under 'verified_sequences'.

  application_menu:
    keytip: F
    items:
      - keytip: "N"
        caption: New
        action: Create new workbook
      - keytip: "O"
        caption: Open
        action: Open existing workbook
      - keytip: "S"
        caption: Save
        action: Save current workbook
      - keytip: "A"
        caption: Save As
        action: Opens Save As submenu (NOT a direct save)
        status: verified
        last_tested: "2026-02-24"
        submenu:
          - keytip: "D"
            caption: Deltek Acumen Workbook
            action: Save As standard .afw workbook
            full_sequence: "Alt,F,A,D"
            status: verified
            last_tested: "2026-02-24"
            notes: "Opens a DirectUI Save dialog (NOT standard Win32). Use FileNameControlHost automation ID, not 1148."
          - keytip: "D0"
            caption: Deltek Acumen Metric Library Template
            action: Save As metric library template
            status: predicted
            notes: "Keytip D0 predicted due to conflict with D above"
      - keytip: "P"
        caption: Print
        action: Print current view
      - keytip: "C"
        caption: Close
        action: Close current workbook
      - keytip: "F"
        caption: Fuse Options
        action: Open options dialog (footer)
      - keytip: "E"
        caption: Exit Fuse
        action: Exit application (footer)

  ribbon_tabs:
    - keytip: "S"
      send_keys: "Alt,S"
      header: "S1 // Projects"
      automation_id: uxProjects
      status: verified
      last_tested: "2026-02-24"
    - keytip: "2"
      send_keys: "Alt,2"
      header: "S2 // Diagnostics"
      automation_id: uxRibbons
      status: verified
      last_tested: "2026-02-24"
    - keytip: "/"
      send_keys: "Alt,OemQuestion"
      header: "S2 // Logic"
      automation_id: uxLogic
      status: verified
      last_tested: "2026-02-24"
      notes: "Keytip is forward slash. send_keys uses OemQuestion (the / key on main keyboard)."
    - keytip: "B"
      send_keys: "Alt,B"
      header: "S2 // Benchmarking"
      automation_id: "S2 // Benchmarking"
      status: verified
      last_tested: "2026-02-24"
    - keytip: "3"
      send_keys: "Alt,3"
      header: "S3 // Risk"
      automation_id: RiskTab
      status: verified
      last_tested: "2026-02-24"
      issues:
        - "First time switching to Risk tab triggers a 'Deltek Mentor Suggestions' dialog — see mentor_dialog section"
    - keytip: "4"
      send_keys: "Alt,4"
      header: "S4 // Acceleration"
      automation_id: "S4 // Acceleration"
      status: verified
      last_tested: "2026-02-24"
    - keytip: "5"
      send_keys: "Alt,5"
      header: "S5 // Dashboard"
      automation_id: uxDashboards
      status: verified
      last_tested: "2026-02-24"
    - keytip: "O"
      send_keys: "Alt,O"
      header: Forensics
      automation_id: UxEnhancedForensicsTabItem
      status: verified
      last_tested: "2026-02-24"
    - keytip: "M"
      send_keys: "Alt,M"
      header: Metrics
      automation_id: uxMetrics
      status: verified
      last_tested: "2026-02-24"
    - keytip: "I"
      send_keys: "Alt,I"
      header: Fields
      automation_id: uxFields
      status: verified
      last_tested: "2026-02-24"

  ribbon_tab_keytip_notes: >
    Keytip convention: Tab prefixed numbers (S1,S2,S3,S4,S5) use their number
    as the keytip (S for S1, 2 for S2 Diagnostics, 3 for S3, etc.).
    S2 sub-tabs use unique letters: / for Logic, B for Benchmarking.
    Non-numbered tabs use a letter: O for fOrensics, M for Metrics, I for fIelds.
    After pressing a tab keytip, a SECOND level of keytips appears for the
    ribbon tools within that tab.

  verified_sequences:
    # -- Application menu --
    - keys: "Alt,F,N"
      action: "File > New workbook"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,F,O"
      action: "File > Open workbook"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,F,S"
      action: "File > Save workbook"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,F,A,D"
      action: "File > Save As > Deltek Acumen Workbook"
      status: verified
      last_tested: "2026-02-24"
      notes: "Opens DirectUI Save dialog (FileNameControlHost, NOT 1148)"
    - keys: "Alt,F,C"
      action: "File > Close workbook"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,F,E"
      action: "File > Exit Fuse"
      status: verified
      last_tested: "2026-02-24"
    # -- Tab switching --
    - keys: "Alt,S"
      action: "Switch to S1 // Projects tab"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,2"
      action: "Switch to S2 // Diagnostics tab"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,OemQuestion"
      action: "Switch to S2 // Logic tab"
      status: verified
      last_tested: "2026-02-24"
      notes: "OemQuestion is the / key on main keyboard"
    - keys: "Alt,B"
      action: "Switch to S2 // Benchmarking tab"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,3"
      action: "Switch to S3 // Risk tab"
      status: verified
      last_tested: "2026-02-24"
      notes: "First time may trigger Deltek Mentor Suggestions dialog"
    - keys: "Alt,4"
      action: "Switch to S4 // Acceleration tab"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,5"
      action: "Switch to S5 // Dashboard tab"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,O"
      action: "Switch to Forensics tab"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,M"
      action: "Switch to Metrics tab"
      status: verified
      last_tested: "2026-02-24"
    - keys: "Alt,I"
      action: "Switch to Fields tab"
      status: verified
      last_tested: "2026-02-24"
    # -- S1 Projects ribbon tools --
    - keys: "Alt,S,O,A"
      action: "S1 Projects > Oracle Primavera > Add P6 file (All types)"
      status: verified
      last_tested: "2026-02-24"
      notes: "Opens file dialog for XER/XML import. Dialog is a separate OS window — wpf_screenshot does not capture it."
    - keys: "Alt,S,R,I"
      action: "S1 Projects > Import > Import All"
      status: verified
      last_tested: "2026-02-24"
      notes: "Imports all linked projects"

# ============================================================
# RIBBON STRUCTURE (Tab > Group > Commands)
# ============================================================
ribbon:
  # ---- S1 // Projects ----
  - tab: "S1 // Projects"
    keytip: "S"
    send_keys: "Alt,S"
    automation_id: uxProjects
    enabled_when: always
    groups:
      - name: "Get External Data From"
        automation_id: ExternalDataRibbonGroup
        tools:
          - name: "Microsoft Project"
            automation_id: MicrosoftProjectMenuTool
            type: menu
            items:
              - "Add File" # GetMspFileCommand
              - "Add from Active Project" # GetMspActiveProjectCommand
              - "Add from Project Server" # GetMspServerProjectCommand
              - "Add Server Projects as Single Project" # GetMspServerAsSingleProjectCommand
              - "Create Project Link from MPP Schedule" # CreateMspMppScheduleCommand
          - name: "Oracle Primavera"
            automation_id: OraclePrimaveraMenuTool
            type: menu
            items:
              - "Add File (XER, All types)" # GetXerFileCommand
              - "Add Multiple XER Files" # GetXerMultipleFileCommand
              - "Add Multiple XER Files as Single Project" # AddP6FileAsSingleProjectCommand
              - "Add File (XML)" # GetP6XmlFileCommand
              - "P6 Web Services" # EstablishP6WebServicesConnectionCommand
              - "Add File (PLN)" # GetPlnFileCommand
              - "Create Link from P6 XER" # CreateP6XerScheduleCommand
              - "Set Baseline" # SetBaselineCommand
              - "Set Baseline and Add Snapshot" # SetBaselineAndAddSnapshotCommand
              - "Clear Baseline" # ClearBaselineCommand
              - "Select Text Encoding" # SetCultureCommand
          - name: "Microsoft Excel"
            automation_id: GetMicrosoftExcelFileButton
            type: menu
            items:
              - "Add File" # GetXlsFileCommand
              - "Cobra CAP" # GetCobraCapFileCommand
              - "ARES PRISM G2" # GetG2FileCommand
              - "Create Cost Estimate" # CreateCostEstimateCommand
          - name: "Deltek Open Plan"
            automation_id: DeltekOpenPlanMenuTool
            type: menu
            items:
              - "Add File (OPP)" # GetOppFileCommand
              - "Add File (BK3)" # GetBk3FileCommand
          - name: "Cost Data"
            automation_id: ImportCostDataMenu
            type: menu
            items:
              - "Import Cost Data" # GetCommonDataFileCommand
          - name: "IPMDAR"
            automation_id: IMPDARMenuTool
            type: menu
          - name: "DOE PARS"
            type: button
            command: GetDOEPARSFileCommand
          - name: "Phoenix Project Manager"
            type: button
            command: GetPhoenixFileCommand
          - name: "Powerproject"
            type: button
            command: GetAstaFileCommand
          - name: "UN/CEFACT"
            type: button
            command: GetUncefactFileCommand
          - name: "Safran"
            type: button
            command: GetSafranFileCommand

      - name: "Import"
        tools:
          - name: "Import All Projects"
            automation_id: ImportAllMenuTool
            type: menu
            items:
              - "Import All Projects" # ImportAllCommand
              - "Import Project" # ImportCommand
          - name: "Filters"
            automation_id: FiltersMenuTool
            type: menu
            items:
              - "Normal"
              - "Summaries"
              - "Milestones"
              - "LOE"
              - "Complete"
              - "In Progress"
              - "Planned"
              - "Resources"

      - name: "Activities"
        tools:
          - name: "SmartGantt Config"
            automation_id: DisplaySmarttGanttConfigurationWindow
            type: button
            notes: "Dialog box launcher for SmartGantt configuration"
          - name: "Activity View"
            automation_id: ProjectsTableView
            type: menu
            items:
              - "SmartGantt grouping/filtering/display level/autofit settings"
          - name: "Display Level Slider"
            type: slider
            notes: "Controls WBS hierarchy display depth"
          - name: "SmartGantt"
            automation_id: SmartGanttMenuTool
            type: menu
            items:
              - "Top/bottom bar date modes, color schemes, progress/float display"
          - name: "Timeline View"
            automation_id: TimelineViewButton
            type: menu

      - name: "Scenario Generation"
        automation_id: ScenarioGenerationRibbonGroup
        tools:
          - name: "Cleanse Schedule"
            type: button
            command: "ScheduleCleanser.ShowCommand"
          - name: "Accelerate Schedule"
            type: button
            command: ShowScheduleCrasherWindowCommand
          - name: "Schedule Realism Adviser"
            type: button
            command: CalibrationAdviserCommand
          - name: "Scenario Calibration"
            automation_id: ScenarioCalibrationMenuTool
            type: menu
            items:
              - "Create Scenario" # CreateScenarioCommand
              - "Run CPM" # RunCpmCommand
              - "Calibration Template" # ShowCalibrationTemplateCommand
          - name: "Export Scenario"
            type: button

      - name: "Editing"
        tools:
          - name: "Add Activity"
            automation_id: AddActivityMenuTool
            type: menu
            items:
              - "Add Activity" # AddActivityCommand
              - "Add Milestone" # AddMilestoneCommand
          - name: "Delete"
            type: button
            command: ProjectsRemoveCommand
          - name: "Convert Snapshot to Project"
            type: button
          - name: "Contracts & Contractors"
            automation_id: EditContractsMenuTool
            type: menu

      - name: "Publish"
        tools:
          - name: "Publish"
            automation_id: ProjectsPublishedMenuTool
            type: menu
            items:
              - "To Excel" # ToExcelCommand
              - "To UN/CEFACT" # ToUncefactCommand
              - "To MS Project MPP" # ToMSProjectMppCommand
              - "To MS Project XML" # ToMSProjectXmlCommand
              - "To Primavera P6 XER" # ExportToPrimaveraP6XerCommand
              - "To Open Plan" # ExportToOpenPlanCommand
              - "To IPMDAR Schedule" # ExportToIPMDRScheduleCommand
              - "To IPMDAR Contract Performance" # ExportToIPMDRContractPerformanceCommand
              - "Print and Export" # PrintAndExportCommand

  # ---- S2 // Diagnostics ----
  - tab: "S2 // Diagnostics"
    keytip: "2"
    send_keys: "Alt,2"
    automation_id: uxRibbons
    enabled_when: project_imported
    groups:
      - name: "Ribbons"
        notes: "Sub-component RibbonsRibbonGroup - metric selection"
        tools:
          - {name: "Projects", type: menu}
          - {name: "Fields", type: menu}
          - {name: "Resources", type: toggle}
          - {name: "Hierarchy", type: menu}
          - {name: "Charts", type: menu}
      - name: "Phases"
        notes: "Sub-component PhasesRibbonGroup - phase navigation"
      - name: "Intersections"
        tools:
          - name: "Charts"
            type: menu
            items: ["Area", "Bar", "Column", "Line", "Point", "Stacked", "Cumulative toggle", "Markers toggle", "Legend toggle"]
      - name: "Tabs"
        tools:
          - name: "Apply To All"
            command: ApplySettingsToAllCommand
      - name: "Analyze"
        tools:
          - name: "Fuse"
            automation_id: FuseMenuTool
            type: menu
            items:
              - "Run Fuse Analysis" # FuseCommand
              - "Adhere to Dates" # AdhereToDates
              - "Variable Definition" # VariableDefinition.ShowCommand
              - "Include/Exclude" # IncludeExclusions
              - "Clear Exclusions" # ClearExclusionsCommand
              - "Clear Annotations" # ClearAnnotationsCommand
              - "Enable Logs" # EnableLogs
              - "Clear Fuse Cache" # ClearFuseCacheCommand
          - name: "Compare"
            type: toggle
            notes: "Toggle IsComparing mode"
      - name: "Logic"
        tools:
          - name: "Trace"
            automation_id: TraceLogicMenuTool
            type: menu
            items:
              - "Toggle Logic Trace" # TraceLogicToggleCommand
              - "Trace Forward" # TraceLogicForwardCommand
              - "Trace Backward" # TraceLogicBackwardCommand
              - "Trace Both Ways" # TraceLogicBothWaysCommand
              - "Path Selection" # PathSelection.ShowDialogCommand
              - "Driving Logic Only" # ChangeDrivingLogicSettingCommand
      - name: "Display Settings"
        tools:
          - name: "Show/Hide"
            type: menu
            items: ["Ribbon Analyzer", "Phase Analyzer", "Show Activities", "Show Links"]
          - name: "Reset Display"
            command: ResetAllDisplaySettingsCommand
      - name: "Activity Browser Modes"
        tools:
          - name: "Tabular View"
            type: toggle
          - name: "TreeMap"
            type: toggle
          - name: "Detailed"
            type: toggle
          - name: "Gantt"
            type: toggle
          - name: "Scorecard"
            type: toggle
          - name: "To Excel"
            type: menu
            command: "ActivityBrowser.ExportToExcelCommand"
          - name: "Undock"
            command: "ActivityBrowser.ShowInWindowCommand"
      - name: "Publish"
        tools:
          - name: "Publish"
            automation_id: PublishAnalysisMenuTool
            type: menu
            items:
              - "Executive Briefing > To Word"
              - "Executive Briefing > To PDF"
              - "To Excel"
              - "Fuse Analyst Report"
              - "DCMA Report"
              - "Fuse Detailed Metric Report"
              - "Fuse Summary Metric Report"
              - "Fuse Metric Validation Report"
              - "Fuse Metric History Report"
              - "Copy To Clipboard (various)"

  # ---- S2 // Logic ----
  - tab: "S2 // Logic"
    keytip: "/"
    send_keys: "Alt,OemQuestion"
    automation_id: uxLogic
    enabled_when: project_imported
    groups:
      - name: "Relationship Types"
        tools: [{name: "All"}, {name: "FS"}, {name: "FF"}, {name: "SF"}, {name: "SS"}]
      - name: "Lags and Leads"
        tools: [{name: "Lags"}, {name: "Leads"}]
      - name: "Logic Checks"
        tools:
          - {name: "Redundancy Index"}
          - {name: "Circular Logic"}
          - {name: "Open Ends"}
          - {name: "Logic On Summaries"}
          - {name: "Out Of Sequence"}
          - {name: "Reverse Logic"}
      - name: "Dangling Activities"
        tools: [{name: "Open Starts"}, {name: "Open Finishes"}]
      - name: "Logic Analysis"
        tools:
          - name: "Logic Sensitivity"
          - name: "Logic Trace"
            automation_id: LogicTraceMenuTool
            type: menu
            items: ["Forward", "Backward", "Both", "Path Selection"]
      - name: "Publish"
        tools: [{name: "To Excel"}, {name: "Copy to Clipboard"}, {name: "Print"}]

  # ---- S2 // Benchmarking ----
  - tab: "S2 // Benchmarking"
    keytip: "B"
    send_keys: "Alt,B"
    automation_id: "S2 // Benchmarking"
    enabled_when: project_imported
    groups:
      - name: "Cloud-based Metric Libraries"
        tools:
          - {name: "Fuse Schedule Index™", type: radio}
          - {name: "Fuse Logic Index™", type: radio}
        notes: "Dynamic radio buttons from Libraries.View"
      - name: "Characteristics"
        tools:
          - {name: "Characteristics", type: label}
          - {type: combobox, notes: "Project type selector"}
        notes: "Project type combo box"
      - name: "Edit"
        tools: [{name: "Copy"}, {name: "Refresh Cloud Libraries"}, {name: "Include/Exclude"}, {name: "Refresh Analysis"}]

  # ---- S3 // Risk ----
  - tab: "S3 // Risk"
    keytip: "3"
    send_keys: "Alt,3"
    automation_id: RiskTab
    enabled_when: project_imported
    groups:
      - name: "Views"
        tools:
          - name: "Left Panel"
            automation_id: RiskLeftPanelMenuTool
            type: menu
            items: ["Activities", "Risk Events", "None", "Most Critical Paths", "Histogram", "Tornado", "Risk Input Charts", "Distribution Analyzer"]
          - name: "Right Panel"
            automation_id: RiskRightPanelMenuTool
            type: menu
            items: ["Activities", "Risk Events", "None", "Most Critical Paths", "Histogram", "Tornado", "Risk Input Charts", "Distribution Analyzer"]
      - name: "Editing"
        tools:
          - {name: "Lock / Unlock", type: toggle}
          - {name: "Lock All Children", type: button}
          - {name: "Unlock All Children", type: button}
          - {name: "Add Activity", automation_id: AddActivityMenuTool2, type: menu}
          - {name: "Delete", type: button}
      - name: "Activities"
        tools:
          - {name: "Activity View", automation_id: ActivityViewMenuTool, type: menu}
          - {name: "Risk Display Level Slider", type: slider, notes: "Range 1-4"}
          - {name: "SmartGantt™", automation_id: RiskGanttMenuTool, type: menu}
          - {name: "Risk Adviser™", type: button}
        notes: "SmartGantt grouping/filtering/display settings"
      - name: "Analysis"
        tools:
          - name: "Run Risk Analysis"
            automation_id: RunRiskAnalysisMenuTool
            type: menu
            items:
              - "Uncertainty Only"
              - "Uncertainty and Risk Events"
              - "Uncertainty and Risk Events (Mitigated, Excluding Overhead)"
              - "Uncertainty and Risk Events (Mitigated, Including Overhead)"
          - name: "Iterations"
            automation_id: RiskIteraionsSpinEdit
            type: spin_edit
          - name: "Converge"
            automation_id: RiskAnalyzeUntilConvergedCheckBox
            type: checkbox
          - name: "Fixed Seed"
            automation_id: RiskUseFixedSeedCheckBox
            type: checkbox
          - name: "Correlation"
            automation_id: RiskCorrelationCheckBox
            type: checkbox
          - name: "Integrate Cost/Schedule"
            automation_id: RiskIntegrateCostScheduleCheckBox
            type: checkbox
          - name: "Build Scenario"
            automation_id: BuildScenarioMenuTool
            type: menu
          - name: "Run CPM Automatically"
            automation_id: RunCpmAutomaticallyToggleButton
            type: toggle
      - name: "Templates"
        tools:
          - {name: "Distribution Template"}
          - {name: "Risk Event Template"}
      - name: "Risk Models"
        tools:
          - name: "Create Cost Estimate"
            automation_id: CreateCostEstimateMenuTool
            type: menu
      - name: "Import / Publish"
        tools:
          - {name: "Print Preview", automation_id: PrintPreviewMenuTool, type: menu}
          - {name: "Microsoft Excel®", automation_id: ExportToExcelMenuTool2, type: menu}
          - {name: "Copy to Clipboard", automation_id: CopyToClipboardMenuTool, type: menu}
          - {name: "Publish", automation_id: RiskPublishMenuTool, type: menu}

  # ---- S4 // Acceleration ----
  - tab: "S4 // Acceleration"
    keytip: "4"
    send_keys: "Alt,4"
    automation_id: "S4 // Acceleration"
    enabled_when: always
    groups:
      - name: "Library"
        tools:
          - {name: "Apply Existing Script Library"}
          - {name: "Merge Existing Script Library"}
          - {name: "Save Script Library as Template"}
      - name: "Script Editor"
        tools: [{name: "Create Script"}, {name: "Remove Script"}]
      - name: "Step Editor"
        tools: [{name: "Create Step"}, {name: "Remove Step"}, {name: "Create Filter Set"}]
      - name: "Acceleration"
        tools:
          - name: "Accelerate Schedule"
            command: RunAccelerationCommand

  # ---- S5 // Dashboard ----
  - tab: "S5 // Dashboard"
    keytip: "5"
    send_keys: "Alt,5"
    automation_id: uxDashboards
    enabled_when: project_imported
    groups:
      - name: "Layout"
        tools:
          - {name: "Layout 1 through Layout 14", type: radio, notes: "14 dashboard layout presets"}
      - name: "Settings"
        tools:
          - name: "Widgets"
            automation_id: WidgetsMenuTool
            type: menu
          - name: "View Mode"
            automation_id: WidgetModeMenuTool
            type: menu
            items: ["Table", "Ribbons (Horizontal)", "Ribbons (Vertical)", "Metrics (Horizontal)", "Metrics (Vertical)"]
          - name: "Autofit"
            type: toggle
          - name: "Copy"
            type: button
      - name: "Publish"
        tools:
          - name: "Copy To Clipboard"

  # ---- Forensics ----
  - tab: Forensics
    keytip: "O"
    send_keys: "Alt,O"
    automation_id: UxEnhancedForensicsTabItem
    enabled_when: always
    status: verified
    last_tested: "2026-02-25"
    notes: >
      The Forensics tab is always enabled (even without data). The main view (EnhancedForensicsView,
      AutomationId=uxForensicsView) has a left panel with an Analysis label and a ListBox
      (AutomationId=uxProjectsList) showing completed analyses, and a right panel with a
      DataGrid showing comparison results. After running an analysis, category tabs appear
      in the results area (Projects, Activities, Fields, Relationships, etc.).
      Currently there is NO filter selection in the Create Analysis wizard — PBI 2555880
      will add this capability.
    groups:
      - name: "Create Analysis"
        tools:
          - name: "Create Analysis"
            type: button
            class_name: ButtonTool
            notes: "Opens the Create Analysis wizard (modal Window). Always enabled."
            status: verified
            last_tested: "2026-02-25"
          - name: "Remove"
            type: button
            class_name: ButtonTool
            notes: "Removes the currently selected analysis"
      - name: "SmartGantt™"
        tools:
          - name: "Filter"
            type: button
            class_name: ButtonTool
            notes: >
              Creates an Activity Grid filter from current forensics results (post-analysis export).
              Only enabled for Activity and ActivityField analysis types. This does NOT filter
              what goes INTO the analysis — it exports results as a filter for the activity grid.
            status: verified
            last_tested: "2026-02-25"
      - name: "Publish"
        tools:
          - name: "Publish"
            automation_id: PublishToExcelMenuTool
            type: menu
            items: ["To Excel (all checks)", "Current Tab to Excel"]

  # ---- Metrics ----
  - tab: Metrics
    keytip: "M"
    send_keys: "Alt,M"
    automation_id: uxMetrics
    enabled_when: always
    groups:
      - name: "Metrics"
        automation_id: uxMetricGroupsGroup
        tools:
          - {name: "New Group"}
          - {name: "New Metric"}
          - {name: "Sync Groups"}
          - {name: "New Sub Group"}
          - {name: "Delete"}
      - name: "Variables"
        notes: "Variable definition commands"
      - name: "Project Variables"
        tools:
          - {name: "New", automation_id: NewProjectVariable}
          - {name: "Delete", automation_id: DeleteProjectVariable}
      - name: "Calculated Fields"
        notes: "Calculated field editing"
      - name: "Functions"
        notes: "Function editing"
      - name: "Control Account Metrics"
        notes: "CA metric editing"
      - name: "Work Package Metrics"
        notes: "WP metric editing"
      - name: "Function Libraries"
        tools:
          - {name: "Common", automation_id: WorkPackageCommonMenuTool, type: menu}
          - {name: "Financial", automation_id: WorkPackageFinancialMenuTool, type: menu}
          - {name: "Logical", automation_id: WorkPackageLogicalMenuTool, type: menu}
          - {name: "Text", automation_id: WorkPacakgeTextMenuTool, type: menu}
          - {name: "Date & Time", automation_id: WorkPackageDateAndTimeMenuTool, type: menu}
          - {name: "Lookup & Reference", automation_id: WorkPackageLookupMenuTool, type: menu}
          - {name: "Math & Trig", automation_id: WorkPackageMathMenuTool, type: menu}
          - {name: "Statistical", automation_id: WorkPackageStatisticalMenuTool, type: menu}
          - {name: "Information", automation_id: WorkPackageInformationMenuTool, type: menu}
          - {name: "Acumen", automation_id: WorkPackageAcumenMenuTool, type: menu}
      - name: "Tripwire Thresholds"
        notes: "Threshold configuration"
      - name: "Clipboard"
        notes: "Copy/paste support"
      - name: "Import"
        tools: [{name: "Open", type: button}]
      - name: "Publish"
        tools:
          - name: "Publish"
            automation_id: MetricsPublishMenuTool
            type: menu

  # ---- Fields ----
  - tab: Fields
    keytip: "I"
    send_keys: "Alt,I"
    automation_id: uxFields
    enabled_when: always
    groups:
      - name: "Source Fields"
        tools:
          - {name: "Map to All Projects"}
          - {name: "Map All Code Fields for this Project"}
          - {name: "Map All Code Fields for All Projects"}
          - {name: "Map All User Fields for All Projects"}
      - name: "Mapped Fields"
        tools:
          - {name: "Delete", automation_id: DeleteMappedFieldCommand}
          - {name: "Load Default Mapping"}
      - name: "Activity Fields"
        tools:
          - {name: "Delete", automation_id: DeleteActivityFieldCommand}
      - name: "Templates"
        tools:
          - {name: "Open", type: button}
          - {name: "Save", type: button}

# ============================================================
# AUTOMATION IDS (for wpf_find / wpf_find_by_path)
# ============================================================
automation_ids:
  # -- Window --
  window:
    - id: TitleBar
      type: TitleBar
      notes: "Main window title bar"
    - id: SystemMenuBar
      type: MenuBar
    - id: Minimize
      type: Button
    - id: Maximize
      type: Button
    - id: Close
      type: Button

  # -- Ribbon --
  ribbon:
    - id: uxRibbon
      type: ToolBar
      class_name: XamRibbon
      notes: "The main ribbon control"
    - id: uxApplicationMenu
      type: Menu
      class_name: ApplicationMenu
      notes: "File/application menu button (top-left logo)"
    - id: XamRibbonTabs
      type: Tab
      class_name: XamTabControl
      notes: "Container for all ribbon tabs"
    - id: dropdownBtn
      type: CheckBox
      notes: "Quick Access Toolbar dropdown toggle"

  # -- Ribbon Tabs --
  ribbon_tabs:
    - id: uxProjects
      type: TabItem
      name: "S1 // Projects"
    - id: uxRibbons
      type: TabItem
      name: "S2 // Diagnostics"
    - id: uxLogic
      type: TabItem
      name: "S2 // Logic"
    - id: "S2 // Benchmarking"
      type: TabItem
      name: "S2 // Benchmarking"
    - id: RiskTab
      type: TabItem
      name: "S3 // Risk"
    - id: "S4 // Acceleration"
      type: TabItem
      name: "S4 // Acceleration"
    - id: uxDashboards
      type: TabItem
      name: "S5 // Dashboard"
    - id: UxEnhancedForensicsTabItem
      type: TabItem
      name: "Forensics"
    - id: uxMetrics
      type: TabItem
      name: "Metrics"
    - id: uxFields
      type: TabItem
      name: "Fields"

  # -- Ribbon Groups --
  ribbon_groups:
    - id: ExternalDataRibbonGroup
      type: ToolBar
      tab: uxProjects
      name: "Get External Data From"
    - id: ScenarioGenerationRibbonGroup
      type: ToolBar
      tab: uxProjects
      name: "Scenario Generation"

  # -- Ribbon Tools (Buttons/Menus) --
  ribbon_tools:
    - id: MicrosoftProjectMenuTool
      type: Menu
      tab: uxProjects
    - id: OraclePrimaveraMenuTool
      type: Menu
      tab: uxProjects
    - id: GetMicrosoftExcelFileButton
      type: Menu
      tab: uxProjects
    - id: DeltekOpenPlanMenuTool
      type: Menu
      tab: uxProjects
    - id: ImportCostDataMenu
      type: Menu
      tab: uxProjects
    - id: IMPDARMenuTool
      type: Menu
      tab: uxProjects
    - id: ImportAllMenuTool
      type: Menu
      tab: uxProjects
    - id: DisplaySmarttGanttConfigurationWindow
      type: Button
      tab: uxProjects
      notes: "SmartGantt configuration dialog launcher"
    - id: ProjectsTableView
      type: Menu
      tab: uxProjects
      name: "Activity View"
    - id: SmartGanttMenuTool
      type: Menu
      tab: uxProjects
    - id: TimelineViewButton
      type: Menu
      tab: uxProjects
    - id: ScenarioCalibrationMenuTool
      type: Menu
      tab: uxProjects
    - id: AddActivityMenuTool
      type: Menu
      tab: uxProjects
    - id: EditContractsMenuTool
      type: Menu
      tab: uxProjects
    - id: ProjectsPublishedMenuTool
      type: Menu
      tab: uxProjects
    - id: SaveAsButton
      type: Button
      tab: application_menu
    - id: AddMspServerMenuItem
      type: Button
      tab: uxProjects
    - id: PrimaveraWebServicesImport
      type: Button
      tab: uxProjects
    - id: OpenPlanImportButton
      type: Button
      tab: uxProjects
    - id: ImportCostDataButton
      type: Button
      tab: uxProjects
    - id: FuseMenuTool
      type: Menu
      tab: uxRibbons
    - id: TraceLogicMenuTool
      type: Menu
      tab: uxRibbons
    - id: ExportToExcelMenuTool
      type: Menu
      tab: uxRibbons
    - id: PublishAnalysisMenuTool
      type: Menu
      tab: uxRibbons
    - id: LogicTraceMenuTool
      type: Menu
      tab: uxLogic
    - id: RunRiskAnalysisMenuTool
      type: Menu
      tab: RiskTab
    - id: RiskIteraionsSpinEdit
      type: SpinEdit
      tab: RiskTab
    - id: RiskAnalyzeUntilConvergedCheckBox
      type: CheckBox
      tab: RiskTab
    - id: RiskUseFixedSeedCheckBox
      type: CheckBox
      tab: RiskTab
    - id: RiskCorrelationCheckBox
      type: CheckBox
      tab: RiskTab
    - id: RiskIntegrateCostScheduleCheckBox
      type: CheckBox
      tab: RiskTab
    - id: BuildScenarioMenuTool
      type: Menu
      tab: RiskTab
    - id: RunCpmAutomaticallyToggleButton
      type: ToggleButton
      tab: RiskTab
    - id: ImportRiskRegisterFromExcel
      type: Button
      tab: RiskTab
    - id: ExportRiskRegisterToExcel
      type: Button
      tab: RiskTab
    - id: ImportRiskRegisterFromEnterpriseRisk
      type: Button
      tab: RiskTab
    - id: ExportRiskRegisterFromEnterpriseRisk
      type: Button
      tab: RiskTab
    - id: WidgetsMenuTool
      type: Menu
      tab: uxDashboards
    - id: WidgetModeMenuTool
      type: Menu
      tab: uxDashboards
    - id: PublishToExcelMenuTool
      type: Menu
      tab: UxEnhancedForensicsTabItem
    - id: NewProjectVariable
      type: Button
      tab: uxMetrics
    - id: DeleteProjectVariable
      type: Button
      tab: uxMetrics
    - id: MetricsPublishMenuTool
      type: Menu
      tab: uxMetrics
    - id: CurrencySymbol
      type: ComboBox
      tab: uxProjects
    - id: RiskCurrencySymbol
      type: ComboBox
      tab: RiskTab

  # -- Forensics --
  forensics:
    - id: uxForensicsView
      type: Custom
      class_name: EnhancedForensicsView
      notes: "Main Forensics content view. Contains analysis list (left) and results grid (right)."
      status: verified
      last_tested: "2026-02-25"
    - id: uxProjectsList
      type: List
      class_name: ListBox
      notes: "Left panel list showing completed forensic analyses. Each item shows base + comparison project names."
      status: verified
      last_tested: "2026-02-25"
    - id: Options
      type: List
      class_name: ListBox
      notes: "Create Analysis wizard step 1 — list of projects to select as base"
      status: verified
      last_tested: "2026-02-25"
    - id: Snapshots
      type: List
      class_name: ListBox
      notes: "Create Analysis wizard step 2 — list of projects to check as comparison snapshots"
      status: verified
      last_tested: "2026-02-25"
    - id: Fields
      type: List
      class_name: ListBox
      notes: "Create Analysis wizard step 4 — list of fields to check for comparison"
      status: verified
      last_tested: "2026-02-25"

  # -- Content Areas --
  content:
    - id: uxProjectsView
      type: Custom
      class_name: ProjectsView
      notes: "Main content container for S1 tab"
    - id: uxTreeView
      type: Custom
      class_name: ProjectsTreeView
      notes: "Projects tree sidebar container"
    - id: PART_TreeView
      type: Tree
      class_name: TreeView
      notes: "Actual tree control inside uxTreeView"
    - id: MinimizeButton
      type: Button
      notes: "Collapse projects sidebar"
    - id: ControlHeader
      type: Text
      notes: "Shows 'Activities - WorkbookName'"
    - id: PART_Timelines
      type: Custom
      class_name: UserControl
      notes: "Timelines panel container"

  # -- Dock Layout --
  dock:
    - id: DockLayoutManager
      type: Group
      class_name: DockLayoutManager
      notes: "Main dock manager for panels"
    - id: Filters
      type: Group
      notes: "Filters panel (collapsible)"
    - id: BottomPanel
      type: Group
      notes: "Bottom activity details panel"
    - id: PART_ExpandButton
      type: Button
      notes: "Panel expand/collapse buttons"

  # -- Activity Grid --
  grid:
    - id: ActivityGrid
      type: DataGrid
      notes: "Main activity data grid (supports Scroll, Grid patterns)"
    - id: SearchPanel
      type: Pane
      notes: "Grid search panel (offscreen by default)"
    - id: HeaderPanel
      type: Header
      notes: "Grid column headers"
    - id: AutoFilterRow
      type: Custom
      class_name: AutoFilterRowControl
      notes: "Auto-filter row below headers"
    - id: dataPresenter
      type: Pane
      notes: "Grid data area"

  # -- Activity Details Tabs --
  activity_details:
    - id: DXTabControl
      type: Tab
      class_name: DXTabControl
      notes: "Activity details tab strip"
    - id: DXTabItem
      type: TabItem
      name: General
    - id: DXTabItem0
      type: TabItem
      name: Status
    - id: DXTabItem1
      type: TabItem
      name: Relationships
    - id: DXTabItem2
      type: TabItem
      name: "Duration Uncertainty"
    - id: DXTabItem3
      type: TabItem
      name: "Cost Uncertainty"
    - id: DXTabItem4
      type: TabItem
      name: Cost
    - id: DXTabItem5
      type: TabItem
      name: "Resource Assignments"
    - id: DXTabItem6
      type: TabItem
      name: "Risk Events"
    - id: DXTabItem7
      type: TabItem
      name: "Control Accounts / Work Packages"

  # -- Activity Details Fields --
  activity_detail_fields:
    general: [Id, Project, Type, Description, WBS, Calendar]
    status: [Remaining, "Remaining (Elapsed)", "Total Float", Status]
    relationships: [Predecessors, Successors]
    duration_uncertainty: [Remaining, "Lower %", "Upper %", "Risk Notes"]
    cost_uncertainty: ["Remaining Cost", "Lower %", "Upper %", "Risk Notes"]
    cost: ["Total Cost", "Actual Cost", "Remaining Cost"]

  # -- Risk Tab Dialogs --
  risk_dialogs:
    - id: Ok
      type: Button
      context: "RiskCorrelationView / CorrelationView dialogs"
    - id: Cancel
      type: Button
      context: "RiskCorrelationView / CorrelationView dialogs"
    - id: CorrelationCoefficient
      type: SpinEdit
      context: "RiskCorrelationView / CorrelationView dialogs"
    - id: RemoveAllCorrelations
      type: Button
    - id: RemoveCorrelations
      type: Button
    - id: AddCorrelations
      type: Button
    - id: AvailableActivitiesGrid
      type: TreeList
      context: CorrelationView
    - id: CorrelatedActivitiesGrid
      type: DataGrid
      context: CorrelationView

  # -- DOE PARS Dialog --
  doe_pars_dialog:
    - id: Ok
      type: Button
    - id: Cancel
      type: Button
    - id: ImportCostData
      type: CheckBox
    - id: ImportRiskData
      type: CheckBox
    - id: ProjectListBox
      type: ListBox
    - id: BaselineProjectsComboBox
      type: ComboBox

  # -- File Dialogs --
  file_dialogs:
    standard_dialog:
      description: "Used by Open, Import, and most file operations"
      filename_field:
        automation_id: "1148"
        class_name: ComboBox
        notes: >
          Standard Windows file dialog filename field.
          Interaction: click field -> Ctrl+A -> type full path -> Enter.
          Use wpf_file_dialog tool or file_dialog macro action.
      status: verified
      last_tested: "2026-02-24"

    save_as_dialog:
      description: "Used by Save As > Deltek Acumen Workbook (Alt,F,A,D)"
      filename_field:
        automation_id: FileNameControlHost
        class_name: DirectUI ComboBox
        notes: >
          Save As uses a DirectUI-based dialog, NOT the standard Win32 dialog.
          wpf_file_dialog DOES NOT WORK with this dialog.
          Instead use: wpf_find(automation_id=FileNameControlHost) -> wpf_type(path) -> send_keys(Enter).
      status: verified
      last_tested: "2026-02-24"
      issues:
        - "wpf_file_dialog tool cannot find FileNameControlHost — must use wpf_find + wpf_type instead"
        - "wpf_screenshot does not capture this dialog (modal OS window)"

    error_detection:
      description: >
        When a file path is invalid, a child error dialog (#32770) appears on top
        of the file dialog. The parent dialog's controls become IsEnabled=False.
      status: verified
      last_tested: "2026-02-24"
      detection_method:
        fast_check: >
          After entering a path and pressing Enter/Open, use wpf_find for
          AutomationId='1148' (standard) or 'FileNameControlHost' (DirectUI)
          and check IsEnabled. If False, an error dialog is blocking.
        error_dialog_structure:
          window_class: "#32770"
          ok_button_automation_id: "2"
          error_text_automation_id: "65535"
          notes: >
            The error dialog is a child #32770 window inside the parent file dialog.
            It has an OK button (AutomationId=2), an icon (AutomationId=20),
            and error text (AutomationId=65535) like "'path' does not exist."
        recovery: >
          Click the OK button (AutomationId=2) to dismiss the error dialog,
          then either correct the path or press Escape to cancel the file dialog.
      notes: >
        Macros cannot do conditional branching, so error detection must be done
        by the AI agent after a macro completes. If a file dialog macro reports
        success but the expected result didn't happen, check for this pattern.

  # -- Deltek Mentor Suggestions Dialog --
  mentor_dialog:
    description: >
      A modal "Deltek Mentor Suggestions" dialog that appears ONLY on S3 Risk
      tabs — specifically when running Risk Analysis or activating the S3 Risk
      tab for the first time. It does NOT appear on other tabs (S1, S2, S4, S5,
      etc.). It blocks all input to the main window. Multiple dialogs may fire
      in sequence — always check for additional dialogs after dismissing one.
    status: verified
    last_tested: "2026-02-24"
    window_class: "#32770"
    title: "Deltek Mentor Suggestions"
    common_elements:
      content_text:
        automation_id: ContentText
        type: Text
        notes: "Contains the warning/suggestion message"
      dont_show_checkbox:
        automation_id: VerificationCheckBox
        type: CheckBox
        name: "Don't show this again"
    variants:
      risk_analysis_no_uncertainty:
        description: "Appears when running Risk Analysis with no uncertainty or mapped risks"
        status: verified
        last_tested: "2026-02-24"
        message: "Running risk analysis with no uncertainty or mapped risks will not generate useful results."
        buttons:
          - automation_id: CommandButton_0
            name: "OK"
            notes: "Stops the analysis"
          - automation_id: CommandButton_1
            name: "Ignore"
            notes: "Proceeds with the analysis anyway"
      risk_analysis_low_quality:
        description: "Appears when schedule quality score is below threshold"
        status: verified
        last_tested: "2026-02-24"
        message: "Looks like your project is not of sufficient schedule quality..."
        buttons:
          - automation_id: CommandButton_0
            name: "OK"
            notes: "Stops the analysis"
          - automation_id: CommandButton_1
            name: "Ignore"
            notes: "Proceeds with the analysis anyway"
          - automation_id: CommandButton_2
            name: "View Schedule Quality"
            notes: "Navigates to S2 Diagnostics schedule quality view"
      risk_tab_first_activation:
        description: "Appears the first time the S3 Risk tab is activated in a session"
        status: predicted
        notes: "May offer Risk Advisor and Risk Register options. Button IDs may differ from Risk Analysis variants."
        buttons:
          - automation_id: CommandButton_0
            name: "Risk Advisor"
          - automation_id: CommandButton_1
            name: "Risk Register"
          - automation_id: CommandButton_2
            name: "Ignore"
    keyboard_dismissal: >
      In Risk Analysis Mentor dialogs, OK is focused by default. Press Tab,Enter
      to move focus to Ignore and activate it. This pattern works reliably for
      both the "no uncertainty" and "low quality" variants.
    handling: >
      To dismiss: click Ignore (CommandButton_1 for Risk Analysis variants,
      CommandButton_2 for tab-activation variant). To suppress permanently:
      check VerificationCheckBox first, then click Ignore.
      This dialog blocks the main window — subsequent tab switches or tool
      clicks will silently fail until the dialog is dismissed.
    notes: >
      IMPORTANT: Multiple Mentor dialogs can fire in sequence during Risk Analysis
      (first "no uncertainty", then "low quality"). Always check for additional
      dialogs after dismissing one. In macros, use two wait+Tab,Enter sequences
      back-to-back to handle both. Detection: wpf_find(control_type=Window,
      class_name=#32770) returns "Element not found" when no dialog is present.

# ============================================================
# ACTIVITY GRID COLUMNS (default column set)
# ============================================================
activity_grid_columns:
  - IncludeInTimeline
  - Id
  - Description
  - Start
  - Finish
  - RemainingDuration
  - Advice
  - Calibration
  - RemainingCost
  - TotalFloat
  - Calendar
  - EarlyStart
  - EarlyFinish
  - LateStart
  - LateFinish
  - IsCritical
  - "Activity Type"
  - "Activity Status"
  - "Percent Complete"
  - GanttChart

# ============================================================
# STATUS BAR
# ============================================================
status_bar:
  elements:
    - name: status_text
      class_name: FuseUserControl
      default_value: "Ready"
      notes: "Shows current status message"
    - name: progress_bar
      class_name: FuseUserControl
      notes: "Progress bar for long operations"
    - name: progress_percent
      class_name: FuseUserControl
      default_value: "0%"
    - name: version
      class_name: MainTrayView
      value: "V8.12.0 x64"

# ============================================================
# PROJECTS SIDEBAR (XamOutlookBar)
# ============================================================
projects_sidebar:
  class_name: XamOutlookBar
  sections:
    - name: Projects
      class_name: OutlookBarGroup
      contains:
        - id: uxTreeView
          type: ProjectsTreeView
          notes: "Tree view showing workbook > projects > snapshots"
    - name: "Explore Deltek Acumen"
      class_name: OutlookBarGroup
      notes: "Getting started / help section"
  controls:
    - id: MinimizeButton
      action: "Collapse/expand sidebar"
    - id: PART_VerticalSplitter
      type: Thumb
      action: "Resize sidebar width"
    - id: MainOverflowMenu
      type: Menu

# ============================================================
# COMMON WORKFLOWS (step-by-step for macro authors)
# ============================================================
workflows:
  new_workbook:
    description: "Create a new empty workbook"
    status: verified
    last_tested: "2026-02-25"
    notes: "The new-workbook.yaml macro was removed. Use these steps inline in other macros instead."
    steps:
      - "Alt,F,N (File > New)"
      - "wait 1s for save prompt"
      - "wpf_find(name='No', control_type=Button) then wpf_click to discard changes"
    result: "New workbook 'Workbook1 (0)' appears in Projects pane"

  open_workbook:
    description: "Open an existing workbook file"
    status: verified
    last_tested: "2026-02-26"
    existing_macro: open-workbook.yaml
    steps:
      - "Alt,F,O (File > Open)"
      - "Navigate file dialog to select .afw workbook file (standard Win32 dialog, uses AutomationId 1148)"
      - "Handle save prompt if existing workbook is open"
      - "wait_for_enabled on uxRibbons (polls until workbook is fully loaded)"
    result: "Workbook loads with all projects/snapshots. Window title changes to workbook name."
    notes: "Open dialog uses standard Win32 file dialog — wpf_file_dialog works. Uses wait_for_enabled instead of blind wait to detect load completion."

  save_workbook:
    description: "Save the current workbook"
    status: verified
    last_tested: "2026-02-26"
    existing_macro: save-workbook.yaml
    steps:
      - "Alt,F,S (File > Save)"
      - "If new workbook: Save As dialog appears (DirectUI, uses FileNameControlHost, NOT 1148)"
      - "wait_for_enabled on uxRibbons (polls until save completes)"
    result: "Workbook saved to disk"
    notes: "If the workbook has already been saved once, no dialog appears — just saves in place. Uses wait_for_enabled instead of blind wait."

  save_workbook_as:
    description: "Save the current workbook to a new file location"
    status: verified
    last_tested: "2026-02-26"
    existing_macro: save-workbook-as.yaml
    steps:
      - "Alt,F,A,D (File > Save As > Deltek Acumen Workbook)"
      - "Wait 1-2s for DirectUI Save dialog to open"
      - "wpf_find(automation_id=FileNameControlHost) to locate filename field"
      - "wpf_type(filepath) to enter the new path"
      - "Enter to confirm"
      - "Handle overwrite dialog if file exists: Left,Enter (Yes is left of No)"
    result: "Workbook saved to new location. Window title changes to new filename."
    issues:
      - "Save As dialog uses DirectUI ComboBox (FileNameControlHost), NOT standard Win32 (1148)"
      - "wpf_file_dialog tool does NOT work with this dialog"
      - "wpf_screenshot cannot capture this dialog (modal OS window)"
    overwrite_dialog:
      description: >
        If the target file already exists, a child #32770 "Save As" confirmation
        dialog appears asking "already exists. Do you want to replace it?"
      status: verified
      last_tested: "2026-02-24"
      buttons:
        - automation_id: "6"
          name: "Yes"
          notes: "Left button — overwrites the file"
        - automation_id: "7"
          name: "No"
          notes: "Right button — cancels back to Save As dialog"
      keyboard_handling: "Left,Enter — moves focus to Yes (left of No) and confirms"
      notes: >
        In macros, always include Left,Enter after the Enter step to handle this
        dialog. If the file doesn't exist, the keystrokes are harmless (sent to
        the main window which is safe).

  close_workbook:
    description: "Close the current workbook without saving"
    status: verified
    last_tested: "2026-02-26"
    existing_macro: close-workbook.yaml
    steps:
      - "Alt,F,C (File > Close)"
      - "wait 1s for save prompt to appear"
      - "wpf_find(name='No', control_type=Button) then wpf_click to discard changes"

  import_xer:
    description: "Import a Primavera P6 XER file"
    status: verified
    last_tested: "2026-02-26"
    existing_macro: import-xer.yaml
    steps:
      - "Focus main window"
      - "Alt,S,O,A (Oracle Primavera > Add File, All types) — keytips, fast"
      - "File dialog: navigate to XER file (wpf_file_dialog)"
      - "Wait 2 seconds for file to load into project tree"
      - "Focus main window"
      - "Alt,S,R,I (Import > Import All) — keytips, fast"
      - "find_by_path to Projects tree root TextBlock (PART_TreeView > TreeItem > Text) with retry timeout"
      - "verify property=name, match_mode=not_equals, expected='Workbook1 (0)' — confirms activities were loaded"
    notes: >
      Uses keytips for both file dialog open and Import All (fast, no tree search).
      The wait: 2 before Import All is critical — gives the app time to load the file
      into the project tree before keytips fire. The find_by_path + verify replaces
      wait_for_enabled as both the wait and the verification — find_by_path retries
      until the element is found, and verify confirms the label changed from the empty state.
    issues:
      - "wpf_screenshot does not capture the file dialog (separate OS window) — agent must trust the keytip sequence worked"

  import_xer_and_analyze:
    description: "Import XER file and run Fuse diagnostics — full end-to-end workflow"
    status: verified
    last_tested: "2026-02-26"
    existing_macro: import-xer-and-analyze.yaml
    steps:
      - "Run import_xer workflow steps (inline, keytips for file dialog + Import All)"
      - "find_by_path + verify (not_equals 'Workbook1 (0)') — confirms import loaded activities"
      - "find+click uxRibbons tab (switch to Diagnostics — reliable post-import)"
      - "F9 (run Fuse analysis)"
      - "wait_for_enabled on uxRibbons (polls until analysis complete)"
    notes: >
      Uses the standard import pattern: keytips for file dialog/Import All (fast),
      find_by_path + verify for import verification (replaces wait_for_enabled after import),
      find+click for post-import tab switching (reliable), wait_for_enabled after F9
      for analysis completion.

  import_msp:
    description: "Import a Microsoft Project file"
    status: verified
    last_tested: "2026-02-26"
    existing_macro: import-mpp-circular-logic.yaml
    steps:
      - "Focus main window"
      - "find+click uxProjects tab (ensure S1 is active)"
      - "find+click MicrosoftProjectMenuTool (opens file dialog directly)"
      - "File dialog: navigate to MPP/XML file (wpf_file_dialog)"
      - "Wait 2 seconds for file to load into project tree"
      - "Focus main window"
      - "Alt,S,R,I (Import > Import All) — keytips, fast"
      - "find_by_path + verify (not_equals 'Workbook1 (0)') — confirms import loaded activities"
    notes: >
      REFERENCE IMPLEMENTATION for import macros. Uses find+click to open the MSP
      file dialog (MicrosoftProjectMenuTool opens dialog directly, unlike OraclePrimaveraMenuTool
      which is a dropdown). Uses keytips for Import All (fast). Post-import verification
      uses find_by_path + verify with match_mode: not_equals to confirm activities loaded.
      All other import macros should follow this pattern.

  import_excel:
    description: "Import from Microsoft Excel"
    status: predicted
    steps:
      - "Focus main window"
      - "find+click uxProjects tab (ensure S1 is active)"
      - "find+click GetMicrosoftExcelFileButton (opens file dialog)"
      - "File dialog: navigate to XLSX file (wpf_file_dialog)"
      - "Wait 2 seconds for file to load into project tree"
      - "Focus main window"
      - "Alt,S,R,I (Import > Import All) — keytips, fast"
      - "wait_for_enabled on uxRibbons (polls until tabs are enabled = import complete)"
    notes: "Predicted — follows the standard import pattern from import-mpp-circular-logic.yaml."

  run_fuse_analysis:
    description: "Run the Fuse diagnostics analysis"
    status: verified
    last_tested: "2026-02-26"
    existing_macro: run-fuse-analysis.yaml
    prerequisites: "Project must be imported with activities"
    steps:
      - "Switch to S2 // Diagnostics tab (click uxRibbons tab)"
      - "Click FuseMenuTool > Run Fuse Analysis (or press F9)"
      - "wait_for_enabled on uxRibbons (polls until analysis complete)"
    shortcut: F9
    notes: >
      Analysis runs very fast on small files (54 activities < 1 second).
      Results are cached — subsequent runs even faster.
      27 analysis sub-tabs populate after analysis (Schedule Quality, Characteristics, Duration, Logic, etc.).
      Uses wait_for_enabled instead of blind wait to detect analysis completion adaptively.

  run_forensic_analysis:
    description: "Import two projects and run a forensic comparison between them"
    status: verified
    last_tested: "2026-02-25"
    prerequisites: "None — the workflow creates a new workbook first, discarding unsaved changes automatically."
    steps:
      - "Create new workbook: Alt,F,N then Tab,Tab,Tab,Enter to dismiss save prompt (harmless if no prompt)"
      - "Import both XER files via Alt,S,O,A (add file) — do NOT import between adds"
      - "Import All via Alt,S,R,I (single import for all added files)"
      - "Wait for import to complete (wait_for_enabled on uxRibbons)"
      - "Switch to Forensics tab (click UxEnhancedForensicsTabItem)"
      - "Click 'Create Analysis' button (ButtonTool in 'Create Analysis' RibbonGroup)"
      - "Step 1 - Base Project Selection: Select project from ListBox (AutomationId=Options), click Next"
      - "Step 2 - Snapshot Selection: Check comparison project(s) in ListBox (AutomationId=Snapshots), click Next"
      - "Step 3 - Subproject Mapping (conditional): If subprojects exist, map them or check 'Ignore Subproject Structure', click Next"
      - "Step 4 - Field Selection: Check fields to compare in ListBox (AutomationId=Fields), click Finish"
      - "Analysis runs and populates the EnhancedForensicsView with results"
    notes: >
      The forensics-create-analysis.yaml and forensics-filter-demo.yaml macros were removed.
      Use these workflow steps inline or recreate as needed.
      The wizard is a modal Window titled 'Create Analysis'. It has 4 steps (3 if no subprojects).
      Navigation: Back/Next/Finish/Cancel buttons. Finish only appears on the last step (Field Selection).
      Multiple XER files can be added before running a single Import All — this is more efficient.
      The sample XER files (Initial Plan.xer, Current Schedule.xer) contain subprojects, so the
      subproject mapping step will appear. Check 'Ignore Subproject Structure' to skip mapping.
    wizard_dialog:
      title: "Create Analysis"
      class_name: Window
      header_text: "Forensic Analysis Wizard"
      steps:
        step1_base_project:
          description: "Select the base project for comparison"
          prompt: "Please select the project that you want to use as a base for comparison during the Forensic Analysis"
          list_automation_id: Options
          list_items: ListItem (one per imported project)
          buttons: [Next, Cancel]
        step2_snapshots:
          description: "Select comparison snapshots"
          prompt: "Please check the projects that you want to compare against the base project"
          list_automation_id: Snapshots
          list_items: "ListItem with CheckBox child (AutomationId matches project name)"
          buttons: [Back, Next, Cancel]
        step3_subproject_mapping:
          description: "Map subprojects across snapshots (conditional — only shown when subprojects exist)"
          prompt: "You have selected projects that contain subprojects..."
          view_class: SubProjectMappingTemplateView
          ignore_checkbox: "Ignore Subproject Structure (Compare using Activity IDs)"
          buttons: [Back, Next, Cancel]
        step4_field_selection:
          description: "Select fields to compare"
          prompt: "Please check the fields that you want to compare in Forensic Analysis"
          list_automation_id: Fields
          list_items: "ListItem with CheckBox child (field names like Activity Status, Start, Finish, etc.)"
          extra_buttons: [Select All, Deselect All]
          buttons: [Back, Finish, Cancel]

  export_to_excel:
    description: "Export diagnostics results to Excel"
    status: verified
    last_tested: "2026-02-26"
    existing_macro: export-to-excel.yaml
    prerequisites: "Fuse analysis must have been run"
    steps:
      - "On S2 // Diagnostics tab"
      - "Click PublishAnalysisMenuTool > 'To Microsoft Excel®' (NOT 'To Excel')"
      - "Save As dialog: uses DirectUI FileNameControlHost (NOT standard 1148)"
      - "Type filepath, press Enter"
      - "wait_for_enabled on uxRibbons (polls until export completes)"
    notes: >
      Confirmed: the Publish dropdown menu item is named 'To Microsoft Excel®'
      (with registered trademark symbol), not 'To Excel'.
      Export Save dialog uses DirectUI (FileNameControlHost), same as workbook Save As.
      Uses wait_for_enabled instead of blind wait to detect export completion.

  run_risk_analysis:
    description: "Run Monte Carlo risk analysis on imported project"
    status: verified
    last_tested: "2026-02-26"
    existing_macro: import-xer-and-risk-analysis.yaml
    prerequisites: >
      Project must be imported AND workbook must be saved to disk first.
      If not saved, a dialog appears: "Please save the workbook before running Risk Analysis."
    steps:
      - "Save workbook first (Alt,F,A,D or Alt,F,S if already saved once)"
      - "Switch to S3 // Risk tab (Alt,3 keytip or click RiskTab)"
      - "Click RunRiskAnalysisMenuTool (find by name='Run Risk Analysis')"
      - "Dismiss Mentor dialog 1 if present: Tab,Enter (selects Ignore)"
      - "Dismiss Mentor dialog 2 if present: Tab,Enter (selects Ignore)"
      - "Wait for simulation to complete (status bar returns to Ready, 100%)"
    notes: >
      RunRiskAnalysisMenuTool is a Menu control type (not Button). Clicking it
      directly runs the default analysis (Uncertainty Only). The dropdown arrow
      opens a submenu with 4 analysis types.
      Up to 2 Mentor suggestion dialogs may appear after clicking Run:
      (1) "no uncertainty or mapped risks" and (2) "schedule quality too low".
      Both can be dismissed with Tab,Enter to select Ignore.
      The macro import-xer-and-risk-analysis.yaml handles the full end-to-end
      flow including new workbook, import, save, tab switch, and dialog dismissal.

  schedule_cleanse:
    description: "Cleanse and fix schedule flaws"
    status: predicted
    steps:
      - "On S1 // Projects tab, select the project"
      - "Click Cleanse Schedule in Scenario Generation group"
      - "Select cleanse options in dialog"
      - "Click OK"
    result: "Cleanse scenario appears under the project"

  accelerate_schedule:
    description: "Run schedule acceleration"
    status: predicted
    steps:
      - "Switch to S4 // Acceleration tab"
      - "Click Accelerate Schedule in Acceleration group"
      - "Set goal (activity or project target)"
      - "Select acceleration script"
      - "Click OK to run simulation"

# ============================================================
# UI NAVIGATION TIPS (for AI agents)
# ============================================================
navigation_tips:
  - tip: "Use keytips (Alt + letter sequences) for fastest navigation. Verified sequences are in the keytips.verified_sequences section."
  - tip: "Tabs can be clicked directly using wpf_find with automation_id (e.g., 'uxProjects', 'uxRibbons', 'RiskTab')"
  - tip: "IMPORT MACRO PATTERN: Keytips for file dialog open + Import All (fast, no tree search). find+click for post-import tab switching and button clicks (reliable). Always wait: 2 before Import All keytips to let the file load. Reference implementation: import-mpp-circular-logic.yaml. Avoid using find+click for Import All — the find is slow on Fuse's complex UI tree."
  - tip: "Menu tools are split buttons - clicking the top half triggers the default action, clicking the bottom arrow opens the submenu"
  - tip: "Many tabs (Diagnostics, Logic, Risk, Dashboard) are disabled (IsEnabled=False) until a project is imported. Tab switching via keytips or click will appear to succeed but has no visible effect without data. Use wait_for_enabled on uxRibbons to detect when import completes."
  - tip: "The Projects sidebar (XamOutlookBar) shows the workbook hierarchy. Use uxTreeView to find project nodes."
  - tip: "Activity Grid supports Scroll and Grid patterns - use these for reading cell data"
  - tip: "Status bar shows 'Ready' when idle - poll this to know when operations complete"
  - tip: "The application menu (file menu) is accessed via uxApplicationMenu or keytip Alt,F"
  - tip: "IMPORTANT: There are TWO types of file dialogs. Open/Import dialogs use standard Win32 with AutomationId '1148' (wpf_file_dialog works). Save/Export dialogs (Save As workbook, Export to Excel) use DirectUI with AutomationId 'FileNameControlHost' (wpf_file_dialog does NOT work — use wpf_find + wpf_type + Enter instead)."
  - tip: "FILE DIALOG ERROR DETECTION: After a file dialog macro, if IsEnabled=False on the filename field (1148 or FileNameControlHost), an error dialog is blocking. Find the child #32770 window, read AutomationId=65535 for the error text, click AutomationId=2 (OK) to dismiss, then Escape to cancel."
  - tip: "The Fuse application menu has no 'Import' item. Use import-xer macro instead (imports via ribbon keytips: Alt,S,O,A for P6 files)."
  - tip: "The Publish menu item for Excel export is named 'To Microsoft Excel®' (with ® symbol), not 'To Excel'."
  - tip: "wpf_screenshot only captures the main application window — modal file dialogs and OS dialogs are NOT captured. Trust keytip sequences and use appropriate dialog interaction method."
  - tip: "MCP TOOL TIMEOUT: There is a ~15-20 second timeout on MCP tool invocations. Macros with total wait time >12s will fail silently. Keep individual wait steps to 2-3 seconds max. NEVER use action: macro (sub-macro calls) — they will always exceed the timeout. Always inline steps directly."
  - tip: "SAVE PROMPT: File > New, File > Open, and File > Close will trigger a save prompt dialog if the workbook has unsaved changes. The dialog has Yes/No/Cancel WPF buttons (no AutomationId). To discard: use wpf_find(name='No', control_type=Button) then wpf_click. In macros where the dialog may or may not appear, use Tab,Tab,Tab,Enter (focus starts on a non-button element, 3 Tabs reach 'No', Enter confirms). Do NOT use Right,Enter or Tab,Enter — they hit 'Yes' (Save) which opens a Save As file dialog."
  - tip: "Window title format is '<WorkbookName> - Deltek Acumen' after a workbook is opened"
  - tip: "For send_keys, use comma-separated keys for sequential presses (e.g., 'Alt,F,C') and + for simultaneous (e.g., 'Ctrl+A')"
  - tip: "IMPORT COMPLETION DETECTION: After triggering Import All, use wait_for_enabled with automation_id: uxRibbons (or any non-S1 tab like uxLogic, RiskTab, uxDashboards) to detect import completion. These tabs are IsEnabled=False when no data is loaded and become IsEnabled=True once import finishes. This is more reliable than static wait steps and adapts to file size. Example macro step: action: wait_for_enabled, automation_id: uxRibbons, timeout: 30"
    status: verified
    last_tested: "2026-02-24"
  - tip: "After importing data, the status bar returns to 'Ready' — but prefer wait_for_enabled on uxRibbons as the primary completion signal"
  - tip: "Right-click context menus exist in the Projects tree and Activity Grid"
  - tip: "RISK ANALYSIS PREREQUISITE: The workbook must be saved to disk before running Risk Analysis. If not saved, a dialog appears saying 'Please save the workbook before running Risk Analysis.' Always save (Alt,F,S or Alt,F,A,D) before clicking Run Risk Analysis."
  - tip: "MENTOR DIALOGS DURING RISK ANALYSIS: After clicking Run Risk Analysis, up to 2 Mentor suggestion dialogs may appear in sequence: (1) 'no uncertainty or mapped risks' and (2) 'schedule quality too low'. Use Tab,Enter to dismiss each (moves focus from OK to Ignore and presses it). Always check for additional dialogs after dismissing one."
  - tip: "DIALOG DETECTION: To check if a modal dialog is blocking, use wpf_find(control_type=Window, class_name=#32770). Returns 'Element not found' when clear. Always verify no dialogs are present before proceeding with the next action."
  - tip: "FILE OVERWRITE DIALOG: When saving over an existing file (Save As), a confirmation dialog asks 'Do you want to replace it?' with Yes (AutomationId=6) and No (AutomationId=7) buttons. Use Left,Enter to select Yes. In macros, always include Left,Enter after Save As Enter — it's harmless if no dialog appears."

# ============================================================
# SUPPORTED DATA FORMATS
# ============================================================
data_formats:
  import:
    - name: "Oracle Primavera P6"
      extensions: [".xer", ".xml", ".pln"]
      tool_id: OraclePrimaveraMenuTool
    - name: "Microsoft Project"
      extensions: [".mpp", ".xml"]
      tool_id: MicrosoftProjectMenuTool
    - name: "Microsoft Excel"
      extensions: [".xls", ".xlsx"]
      tool_id: GetMicrosoftExcelFileButton
    - name: "Deltek Open Plan"
      extensions: [".opp", ".bk3"]
      tool_id: DeltekOpenPlanMenuTool
    - name: "Cost Data (CSV/Cobra/WAD/IPMDAR)"
      tool_id: ImportCostDataMenu
    - name: "IPMDAR"
      tool_id: IMPDARMenuTool
    - name: "DOE PARS"
      command: GetDOEPARSFileCommand
    - name: "Phoenix Project Manager"
      command: GetPhoenixFileCommand
    - name: "Asta Powerproject"
      command: GetAstaFileCommand
    - name: "UN/CEFACT XML"
      command: GetUncefactFileCommand
    - name: "Safran"
      command: GetSafranFileCommand

  export:
    - name: "Microsoft Excel"
      command: ToExcelCommand
    - name: "UN/CEFACT XML"
      command: ToUncefactCommand
    - name: "Microsoft Project MPP"
      command: ToMSProjectMppCommand
    - name: "Microsoft Project XML"
      command: ToMSProjectXmlCommand
    - name: "Oracle Primavera P6 XER"
      command: ExportToPrimaveraP6XerCommand
    - name: "Deltek Open Plan"
      command: ExportToOpenPlanCommand
    - name: "IPMDAR Schedule"
      command: ExportToIPMDRScheduleCommand
    - name: "IPMDAR Contract Performance"
      command: ExportToIPMDRContractPerformanceCommand

  workbook:
    extension: ".afw"
    notes: "Acumen Fuse Workbook format. Contains all imported data, analysis results, and settings."
